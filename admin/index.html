<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AB Resolver Admin</title>
  <link rel="stylesheet" href="style.css">
  <!-- Add Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Add Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app">
    <header>
      <div class="header-content">
        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
          <h1>AB Testing Dashboard</h1>
          <div style="color: var(--gray-500); font-size: 0.875rem;">
            System time: <span id="systemTime"></span>
          </div>
        </div>
        <div class="header-actions">
          <button id="refreshBtn" class="icon-button" title="Refresh">
            <span class="material-icons">refresh</span>
          </button>
          <a href="/admin/logout" class="button danger">
            <span class="material-icons">logout</span>
            Logout
          </a>
        </div>
      </div>
    </header>

    <main>
      <section id="new-exp" class="card">
        <div class="card-header">
          <h2>Create Experiment</h2>
        </div>
        <form id="createForm" class="card-content">
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="exp-name">Experiment Name</label>
              <input type="text" id="exp-name" name="name" required placeholder="e.g., Homepage Hero Image Test" />
            </div>
            <div class="form-group full-width">
              <label for="exp-baseline">Baseline URL</label>
              <input type="url" id="exp-baseline" name="baseline_url" required placeholder="Control variant URL" />
            </div>
            <div class="form-group full-width">
              <label for="exp-test">Test URL</label>
              <input type="url" id="exp-test" name="test_url" required placeholder="Test variant URL" />
            </div>
            <div class="form-group">
              <label for="exp-split">Split Ratio (B)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="exp-split" name="allocation_b" min="0" max="1" step="0.1" value="0.5" style="flex: 1;" />
                <output for="exp-split" style="min-width: 3rem;">50%</output>
              </div>
            </div>
            <div class="form-group">
              <div class="checkbox-group">
                <input type="checkbox" id="exp-params" name="preserve_params" checked />
                <label for="exp-params">Preserve URL Parameters</label>
              </div>
            </div>
            <div class="form-group">
              <label for="exp-start">Start Date (optional)</label>
              <input type="datetime-local" id="exp-start" name="start_at" class="datetime-input" />
              <small>When to start the experiment</small>
            </div>
            <div class="form-group">
              <label for="exp-stop">End Date (optional)</label>
              <input type="datetime-local" id="exp-stop" name="stop_at" class="datetime-input" />
              <small>When to end the experiment</small>
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="button primary">
              <span class="material-icons">add</span>
              Create Experiment
            </button>
          </div>
        </form>
      </section>

      <section id="experiments" class="card">
        <div class="card-header">
          <h2>Active Experiments</h2>
          <div class="card-actions">
            <div class="search-box">
              <span class="material-icons">search</span>
              <input type="text" id="searchExp" placeholder="Search experiments...">
            </div>
          </div>
        </div>
        <div class="card-content">
          <div id="experimentsTable" class="experiments-table">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Status</th>
                  <th>URLs</th>
                  <th>Split</th>
                  <th>Dates</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="expTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content card">
        <div class="card-header">
          <h2>Edit Experiment</h2>
          <button class="icon-button" onclick="closeEditModal()">
            <span class="material-icons">close</span>
          </button>
        </div>
        <form id="editForm" class="card-content">
          <input type="hidden" name="id" />
          <div class="form-grid">
            <div class="form-group">
              <label for="edit-name">Name</label>
              <input type="text" id="edit-name" name="name" required />
              <small>Descriptive name</small>
            </div>
            <div class="form-group">
              <label for="edit-split">Split Ratio (B)</label>
              <input type="range" id="edit-split" name="allocation_b" min="0" max="1" step="0.1" value="0.5" />
              <output for="edit-split">50%</output>
              <small>Percentage of traffic to variant B</small>
            </div>
            <div class="form-group full-width">
              <label for="edit-baseline">Baseline URL</label>
              <input type="url" id="edit-baseline" name="baseline_url" required />
              <small>Control variant URL</small>
            </div>
            <div class="form-group full-width">
              <label for="edit-test">Test URL</label>
              <input type="url" id="edit-test" name="test_url" required />
              <small>Test variant URL</small>
            </div>
            <div class="form-group">
              <label for="edit-params">Preserve Parameters</label>
              <select id="edit-params" name="preserve_params">
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
              <small>Keep URL parameters when redirecting</small>
            </div>
            <div class="form-group">
              <label for="edit-status">Status</label>
              <select id="edit-status" name="status">
                <option value="draft">Draft</option>
                <option value="running">Running</option>
                <option value="paused">Paused</option>
                <option value="stopped">Stopped</option>
              </select>
              <small>Experiment status</small>
            </div>
            <div class="form-group">
              <label for="edit-start">Start Date</label>
              <input type="datetime-local" id="edit-start" name="start_at" />
              <small>When to start the experiment</small>
            </div>
            <div class="form-group">
              <label for="edit-stop">End Date</label>
              <input type="datetime-local" id="edit-stop" name="stop_at" />
              <small>When to end the experiment</small>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="button" onclick="closeEditModal()">Cancel</button>
            <button type="submit" class="button primary">
              <span class="material-icons">save</span>
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Toast container for notifications -->
    <div id="toast" class="toast"></div>
  </div>

  <script src="admin.js"></script>
</body>
</html>